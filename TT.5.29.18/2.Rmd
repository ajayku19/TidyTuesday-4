library(tidyverse)

data <- read_csv("comic.data.csv") %>% select(-X1)

newdata <- data %>% select(publisher, align, sex) %>% na.omit() %>% group_by(publisher, align, sex) %>% tally()

totalpub <- data %>% select(publisher, align, sex) %>% na.omit() %>% group_by(publisher) %>% tally()

df <- left_join(newdata, totalpub, by="publisher") %>% mutate(pct = (n.x/n.y) * 100) %>% select(-n.x, -n.y)

A <- ggplot(df) +
  geom_point(aes(align, sex, size=pct, color=align)) +
  geom_text(aes(align, sex, label=paste(round(pct,2),"%"))) + 
  facet_wrap(~ publisher, scales="free_x") +
  scale_size_continuous(range = c(10, 30), guide = 'none') +
  theme(legend.position="bottom", legend.title=element_blank(), axis.title=element_blank(), axis.text.x=element_blank(), axis.ticks.x=element_blank()) +
  scale_color_manual(values=c("#ffff00", "#ffad33", "#ff1a1a"))

plot(A)
